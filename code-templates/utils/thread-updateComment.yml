parameters:
  - name: 'messageContent'
    type: string
  - name: 'ts'
    default: 4
    type: number
  - name: 'isParametrizedMsg'
    default: true

steps:
  - task: Bash@3
    displayName: 'Update Comment'
    condition: and(always(), not(and( failed(), ne('${{parameters.isParametrizedMsg}}', 'true'))))
    inputs:
      targetType: 'inline'
      script: |
        if [[ ! -z '${{ parameters.messageContent }}' && '${{ parameters.messageContent }}' != '$('* ]]; then
          python3.7 $(Pipeline.Workspace)/$(PATH_SCRIPTS)/callGitServer/call_git_server.py comment --no-ssl --force-https -m "${{ parameters.messageContent }}"  -mr $(pullRequestId) -t $(REST_AZURE_TOKEN) -o $(owner) -p $(GIT_PROJECT_NAME) -ri $(GIT_REPOSITORY_NAME) -e -r $(repoHost) -b ''1'' -w ''1'' -e -ti $(pullRequestThreadId) -ts ${{ parameters.ts }}
        fi
      failOnStderr: true
